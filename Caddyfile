vsbuilder.techifyboost.com {
    # Automatic HTTPS with Let's Encrypt

    # Reverse proxy to the app container
    reverse_proxy app:3000 {
        # Health check
        health_uri /
        health_interval 30s

        # Headers for Shopify iframe compatibility
        header_up X-Forwarded-Proto {scheme}
        header_up X-Real-IP {remote_host}
    }

    # Security headers
    header {
        # Allow Shopify to embed in iframe
        Content-Security-Policy "frame-ancestors https://*.myshopify.com https://admin.shopify.com;"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "ALLOW-FROM https://admin.shopify.com"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Logging
    log {
        output file /var/log/caddy/access.log
        format json
    }
}
