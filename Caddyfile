vsbuilder.techifyboost.com {
    # Reverse proxy to the app container
    reverse_proxy app:3000 {
        # Disable passive health checks (we trust Docker's health check)
        lb_try_duration 0
    }

    # Override response headers for iframe compatibility
    header {
        # Remove CSP from backend response and set our own
        -Content-Security-Policy
        Content-Security-Policy "frame-ancestors https://*.myshopify.com https://admin.shopify.com https://*.techifyboost.com 'self';"

        # Remove X-Frame-Options to allow framing
        -X-Frame-Options

        # Security headers
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

# HTTP to HTTPS redirect
:80 {
    redir https://{host}{uri} permanent
}
